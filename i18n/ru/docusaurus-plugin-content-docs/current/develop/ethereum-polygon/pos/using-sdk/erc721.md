---
id: erc721
title: Руководство по депозиту и выводу ERC721
sidebar_label: ERC721
description: "Депозит и вывод токенов ERC721 в сети Polygon."
keywords:
  - docs
  - matic
image: https://matic.network/banners/matic-network-16x9.png
---

Ознакомьтесь с актуальной [документацией Matic.js по ERC20](https://maticnetwork.github.io/matic.js/docs/pos/erc721/).

Это руководство использует тестовую сеть Polygon ( Mumbai ), которая сопоставлена с сетью Goerli, для демонстрации трансфера активов между двумя блокчейнами. **Важно отметить, что** при следовании указаниям настоящего руководства следует использовать адрес прокси всегда, когда это возможно. Например, адрес **RootChainManagerProxy** следует использовать для взаимодействия вместо адреса **RootChainManager**. **Адреса контрактов PoS, ABI, адреса тестовых токенов** и другие детали развертывания контрактов моста PoS можно найти [здесь](/docs/develop/ethereum-polygon/pos/deployment).

**Сопоставление активов** необходимо для интеграции моста PoS в ваше приложение. Вы можете отправить запрос на сопоставление [здесь](/docs/develop/ethereum-polygon/submit-mapping-request). Однако для целей настоящего руководства мы уже развернули **тестовые токены** и выполнили их сопоставление на мосту PoS. Это может вам потребоваться, если вы захотите попробовать выполнить указания руководства самостоятельно. Вы можете запросить желаемый актив из [faucet](https://faucet.polygon.technology/). Если тестовые токены недоступны на faucet, свяжитесь с нами в [discord](https://discord.com/invite/0xPolygon)

В будущем руководстве каждый шаг будет разъяснен подробно с предоставлением нескольких сниппетов кода. Однако вы всегда сможете сослаться на этот [репозиторий](https://github.com/maticnetwork/matic.js/tree/v2.0.2/examples/POS-client), который будет содержать все **примеры исходного кода**, которые могут помочь вам выполнить интеграцию и понять принципы работы моста PoS.

## Поток высокого уровня {#high-level-flow}

Депозит ERC721 -

1. **_Утвердите контракт _** **_ERC721Predicate_** для получения возможности тратить вносимые токены.
2. Выполните вызов **_depositFor_** в **_RootChainManager_**.

Вывод ERC721 -

1. **_Сожгите_** токены в Polygon chain.
2. Вызовите функцию **_exit_** в **_RootChainManager_** для отправки подтверждения транзакции сжигания. Этот вызов можно сделать **_после отправки checkpoint_** для блока, содержащего транзакцию сжигания.

## Детали шага {#step-details}

---

### Утвердить {#approve}

[Метод Approve](https://maticnetwork.github.io/matic.js/docs/pos/erc721/approve/) — это нормальное утверждение ERC721, дающее **_ERC721Predicate_** возможность вызывать функцию **_transferFrom_**. Клиент Polygon POS открывает метод **_approve_** для выполнения этого вызова.

```jsx
const execute = async () => {
  const client = await getPOSClient();
  const erc721RootToken = posClient.erc721(<root token address>,true);
  const approveResult = await erc721RootToken.approve(<token id>);
  const txHash = await approveResult.getTransactionHash();
  const txReceipt = await approveResult.getReceipt();
}
 ```

### Депозит {#deposit}

[Метод Deposit](https://maticnetwork.github.io/matic.js/docs/pos/erc721/deposit/) можно выполнить, вызвав **_depositFor_** в контракте RootChainManager. Обратите внимание, что необходимо выполнить сопоставление и утверждение токена для передачи заранее. После передачи токенов процедура депозита продолжается с использованием механизма StateSync. Клиент Polygon POS открывает метод **_depositERC721ForUser_** для выполнения этого вызова.

```jsx
const execute = async () => {
  const client = await getPOSClient();
  const erc721RootToken = posClient.erc721(<root token address>, true);
  const result = await erc721RootToken.deposit(<token id>, <user address>);
  const txHash = await result.getTransactionHash();
  const txReceipt = await result.getReceipt();
}
```

Дополнительное примечание. Депозиты из Ethereum в Polygon выполняются с использованием механизма **синхронизации состояния,** и это занимает приблизительно 5-7 минут. После ожидания в течение этого временного интервала рекомендуется проверить баланс с помощью библиотеки web3.js/matic.js или Metamask. Баланс будет показан в обозревателе, только если в дочерней цепочке была выполнена только одна передача активов. По этой [ссылке](https://docs.polygon.technology/docs/develop/ethereum-polygon/pos/deposit-withdraw-event-pos/) вы узнаете, как отслеживать события депозита.

> ПРИМЕЧАНИЕ. Депозиты из Ethereum в Polygon выполняются с использованием механизма синхронизации состояния, и это занимает примерно ~5-7 минут. После ожидания в течение этого временного интервала рекомендуется проверить баланс с помощью библиотеки web3.js/matic.js или Metamask. Баланс будет показан в обозревателе, только если в дочерней цепочке была выполнена только одна передача активов. По этой [ссылке](/docs/develop/ethereum-polygon/pos/deposit-withdraw-event-pos) вы узнаете, как отслеживать события депозита.

### Сжигание WithdrawStart {#burn-withdrawstart}

Пользователь может вызвать функцию **_withdraw_** контракта **_ChildToken_**. Эта функция должна сжечь токены. Клиент Polygon POS открывает метод [withdrawStart](https://maticnetwork.github.io/matic.js/docs/pos/erc721/withdraw-start/) для выполнения этого вызова.

```jsx
const execute = async () => {
  const client = await getPOSClient();
  const erc721Token = posClient.erc721(<child token address>);
  const result = await erc721Token.withdrawStart(<token id>);
  const txHash = await result.getTransactionHash();
  const txReceipt = await result.getReceipt();
}
```

Сохраните хэш транзакции для этого вызова и используйте его при генерировании доказательства сжигания.

### Выход {#exit}

После отправки **_checkpoint_** для блока, **_содержащего_** транзакцию сжигания, пользователь должен вызвать функцию **_exit_** контракта **_RootChainManager_** и отправить доказательство сжигания. После отправки корректного доказательства токены передаются пользователю. Клиент Polygon POS открывает метод **_withdrawExit_** для выполнения этого вызова. Эту функцию можно вызвать только после включения checkpoint в основную цепочку. Включение контрольной точки можно отследить с помощью этого [руководства](/docs/develop/ethereum-polygon/pos/deposit-withdraw-event-pos/#checkpoint-events).

```jsx
const execute = async () => {
  const client = await getPOSClient();
  const erc721RootToken = posClient.erc721(<root token address>, true);
  const result = await erc721RootToken.withdrawExit(<burn tx hash>);
  const txHash = await result.getTransactionHash();
  const txReceipt = await result.getReceipt();
}
```
