---
id: erc1155
title: Руководство по депозиту и выводу ERC1155
sidebar_label: ERC1155
description: "Депозит и вывод токенов ERC1155 в сети Polygon."
keywords:
  - docs
  - matic
image: https://matic.network/banners/matic-network-16x9.png
---

Ознакомьтесь с актуальной документацией по [Matic.js для ERC1155](https://maticnetwork.github.io/matic.js/docs/pos/erc1155/).

Это руководство использует тестовую сеть Polygon ( Mumbai ), которая сопоставлена с сетью Goerli, для демонстрации перевода активов между двумя блокчейнами. **Важно отметить, что** при следовании указаниям настоящего руководства следует использовать адрес прокси всегда, когда это возможно. Например, адрес **RootChainManagerProxy** следует использовать для взаимодействия вместо адреса **RootChainManager**. **Адреса контрактов PoS, ABI, адреса тестовых токенов** и другие детали развертывания контрактов моста PoS можно найти [здесь](/docs/develop/ethereum-polygon/pos/deployment).

**Сопоставление активов** необходимо для интеграции моста PoS в ваше приложение. Вы можете отправить запрос на сопоставление [здесь](/docs/develop/ethereum-polygon/submit-mapping-request). Однако для целей настоящего руководства мы уже развернули **тестовые токены** и выполнили их сопоставление на мосту PoS. Это может вам потребоваться, если вы захотите попробовать выполнить указания руководства самостоятельно. Вы можете запросить желаемый актив из [faucet](https://faucet.polygon.technology/). Если тестовые токены недоступны на faucet, свяжитесь с нами в [discord](https://discord.com/invite/0xPolygon)

В будущем руководстве каждый шаг будет разъяснен подробно с предоставлением нескольких сниппетов кода. Однако вы всегда сможете сослаться на этот [репозиторий](https://github.com/maticnetwork/matic.js/tree/master/examples/pos), который будет содержать все **примеры исходного кода**, которые могут помочь вам выполнить интеграцию и понять принципы работы моста PoS.

## Поток высокого уровня {#high-level-flow}

Внесите депозит ERC1155 -

1. **_Утвердите контракт_** **_ERC1155Predicate_** для получения возможности тратить вносимые токены.
2. Выполните вызов **_depositFor_** в **_RootChainManager_**.

Выведите ERC1155 -

1. **_Сожгите_** токены в Polygon chain.
2. Вызовите функцию **_exit_** в **_RootChainManager_** для отправки подтверждения транзакции сжигания. Этот вызов можно сделать **_после отправки checkpoint_** для блока, содержащего транзакцию сжигания.

## Детали шага {#step-details}

---

### approveALL {#approveall}

[Метод approveAll](https://maticnetwork.github.io/matic.js/docs/pos/erc1155/approve-all/)

Это нормальное утверждение ERC1155, позволяющее `ERC1155Predicate` вызвать функцию `transferFrom`. Polygon `POSClient` открывает метод [`approveERC1155ForDeposit`](https://github.com/maticnetwork/matic.js/blob/4bf4fa9438d56c9b5c282f456aa2c24f6ff6083d/src/index.ts#L231) для выполнения этого вызова.

```jsx
const erc1155RootToken = posClient.erc1155(<root token address>,true);
const approveResult = await erc1155RootToken.approveAll();
const txHash = await approveResult.getTransactionHash();
const txReceipt = await approveResult.getReceipt();

```

### Депозит {#deposit}

[Метод депозита](https://maticnetwork.github.io/matic.js/docs/pos/erc1155/deposit/) можно выполнить, вызвав `depositFor` для контракта `RootChainManager`. Обратите внимание, что необходимо выполнить сопоставление и утверждение токена для передачи заранее. После передачи токенов процедура депозита продолжается с использованием механизма **_StateSync_**. Polygon `POSClient` открывает методы [`depositSingleERC1155ForUser`](https://github.com/maticnetwork/matic.js/blob/4bf4fa9438d56c9b5c282f456aa2c24f6ff6083d/src/index.ts#L245) и [`depositBatchERC1155ForUser`](https://github.com/maticnetwork/matic.js/blob/4bf4fa9438d56c9b5c282f456aa2c24f6ff6083d/src/index.ts#L259) для выполнения этого вызова.

```jsx
const erc1155RootToken = posClient.erc1155(<root token address>, true);

const result = await erc1155RootToken.deposit({
    amount: 1,
    tokenId: '123',
    userAddress: <from address>,
    data: '0x5465737445524331313535', // data is optional
});

const txHash = await result.getTransactionHash();
const txReceipt = await result.getReceipt();
```

Функция `deposit` в `ChildToken` вызывается `ChildChainManager`. При выполнении этого вызова минтинг токенов должен быть выполнен.

> ПРИМЕЧАНИЕ. Депозиты из Ethereum в Polygon выполняются с использованием механизма синхронизации состояния, и это занимает примерно ~5-7 минут. После ожидания в течение этого временного интервала рекомендуется проверить баланс с помощью библиотеки web3.js/matic.js или Metamask. Баланс будет показан в обозревателе, только если в дочерней цепочке была выполнена только одна передача активов. По этой [ссылке](/docs/develop/ethereum-polygon/pos/deposit-withdraw-event-pos) вы узнаете, как отслеживать события депозита.

### Сжигание {#burn}

Пользователь может вызвать функцию `withdraw` контракта `ChildToken`. Эта функция должна сжечь токены. Polygon `POSClient` открывает методы `burnSingleERC1155` и `burnBatchERC1155` для выполнения этого вызова.

```jsx
const erc1155Token = posClient.erc1155(<child token address>);
const result = await erc1155Token.withdrawStart(<token id>,<amount>);
const txHash = await result.getTransactionHash();
const txReceipt = await result.getReceipt();
```

**Сохраните хэш транзакции для этого вызова и используйте его при генерировании доказательства сжигания.**

### Выход {#exit}

[Метод WithdrawExit](https://maticnetwork.github.io/matic.js/docs/pos/erc1155/withdraw-exit/)
 После того, как `checkpoint` будет **_отправлено_** для блока, содержащего транзакцию сжигания, пользователь должен вызвать функцию `exit` контракта `RootChainManager` и отправить доказательство сжигания. После отправки корректного доказательства токены передаются пользователю. Клиент Polygon POS открывает методы `exitBatchERC1155` и `exitSingleERC1155` для выполнения этого вызова. Эту функцию можно вызвать только после включения checkpoint в основную цепочку. Включение контрольной точки можно отследить с помощью этого [руководства](/docs/develop/ethereum-polygon/pos/deposit-withdraw-event-pos#checkpoint-events).

```jsx
const erc1155RootToken = posClient.erc1155(<root token address>, true);
const result = await erc1155RootToken.withdrawExit(<burn tx hash>);
const txHash = await result.getTransactionHash();
const txReceipt = await result.getReceipt();
```
